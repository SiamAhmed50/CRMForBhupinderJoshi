@page
@model ClientsModel

@{
    ViewData["Title"] = "Clients";
}
 
    <div class="row">
        <div class="col-sm-6 text-start">
            <h2>Clients</h2>
        </div>
        <div class="col-sm-6 text-end">
            <button type="button" class="btn btn-primary waves-effect waves-light" data-bs-toggle="modal" data-bs-target="#clientModal">
                Add Client
            </button>
        </div>
    </div>
    <div class="container mt-4">




        <table id="clientTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Client ID <span class="sort-indicator" id="sortClientId"></span></th>
                    <th>License Number <span class="sort-indicator" id="sortLicenseNumber"></span></th>
                    <th>License Start Date</th>
                    <th>License End Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <div class="mt-3">
        <!-- Button trigger modal -->
        <!-- Modal -->
        <div class="modal fade" id="clientModal" tabindex="-1" aria-hidden="true" style="display: none;">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form method="post">


                        <div class="modal-header">
                            <h4 class="modal-title" id="exampleModalLabel1">Client Details</h4>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col mb-4 mt-2">
                                    <div class="form-floating form-floating-outline">
                                        <input type="text" asp-for="ClientModel.Name" class="form-control" placeholder="Enter Name">
                                        <label for="nameBasic">Name</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-2">
                                <div class="col mb-2">
                                    <div class="form-floating form-floating-outline">
                                    <input type="text" asp-for="ClientModel.ClientId" class="form-control" value="@Model.ClientModel.ClientId" placeholder="Enter Client ID" readonly>
                                        <label for="clientIdBasic">Client ID</label>
                                    </div>
                                </div>
                                <div class="col mb-2">
                                    <div class="form-floating form-floating-outline">
                                    <input type="text" asp-for="ClientModel.LicenseNumber" class="form-control" value="@Model.ClientModel.LicenseNumber" placeholder="Enter License Number" readonly>
                                        <label for="licenseNumberBasic">License Number</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-2">
                                <div class="col mb-2">
                                    <div class="form-floating form-floating-outline">
                                    <input type="date" asp-for="ClientModel.LicenseStartDate" class="form-control">
                                        <label for="licenseStartDateBasic">License Start Date</label>
                                    </div>
                                </div>
                                <div class="col mb-2">
                                    <div class="form-floating form-floating-outline">
                                    <input type="date" asp-for="ClientModel.LicenseEndDate" class="form-control">
                                        <label for="licenseEndDateBasic">License End Date</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary waves-effect" data-bs-dismiss="modal">
                                Close
                            </button>
                            <button type="submit" class="btn btn-primary waves-effect waves-light">Save changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <div class="modal fade" id="clientModalEdit" tabindex="-1" aria-hidden="true" style="display: none;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form method="post">


                    <div class="modal-header">
                        <h4 class="modal-title" id="exampleModalLabel1">Client Details</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col mb-4 mt-2">
                                <div class="form-floating form-floating-outline">
                                    <input type="text" asp-for="ClientModel.Name" class="form-control" placeholder="Enter Name">
                                    <label for="nameBasic">Name</label>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col mb-2">
                                <div class="form-floating form-floating-outline">
                                    <input type="text" asp-for="ClientModel.ClientId" class="form-control" value="@Model.ClientModel.ClientId" placeholder="Enter Client ID" readonly>
                                    <label for="clientIdBasic">Client ID</label>
                                </div>
                            </div>
                            <div class="col mb-2">
                                <div class="form-floating form-floating-outline">
                                    <input type="text" asp-for="ClientModel.LicenseNumber" class="form-control" value="@Model.ClientModel.LicenseNumber" placeholder="Enter License Number" readonly>
                                    <label for="licenseNumberBasic">License Number</label>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col mb-2">
                                <div class="form-floating form-floating-outline">
                                    <input type="date" asp-for="ClientModel.LicenseStartDate" class="form-control">
                                    <label for="licenseStartDateBasic">License Start Date</label>
                                </div>
                            </div>
                            <div class="col mb-2">
                                <div class="form-floating form-floating-outline">
                                    <input type="date" asp-for="ClientModel.LicenseEndDate" class="form-control">
                                    <label for="licenseEndDateBasic">License End Date</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary waves-effect" data-bs-dismiss="modal">
                            Close
                        </button>
                        <button type="submit" class="btn btn-primary waves-effect waves-light">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    </div>
 
@section Scripts {
  
    
    <script>
        $(document).ready(function () {
            var table = $('#clientTable').DataTable({
                "ajax": {
                    "type" : "POST",
                    "url": "/Clients?handler=List",
                    "dataSrc": "",
                    "beforeSend": function (xhr) {
                        xhr.setRequestHeader("XSRF-TOKEN",
                            $('input:hidden[name="__RequestVerificationToken"]').val());
                    }
                },
                "columns": [
                    { "data": "id" },
                    { "data": "name" },
                    { "data": "clientId" },
                    { "data": "licenseNumber" },
                    { "data": "licenseStartDate" },
                    { "data": "licenseEndDate" },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return '<button class="btn btn-info me-2" onclick="editClient(' + row.id + ')">Edit</button>' +
                                '<button class="btn btn-danger me-2" onclick="deleteClient(' + row.id + ')">Delete</button>';
                        }
                    }
                ],
                "order": [[2, 'asc']]
            });

            $('#sortClientId').click(function () {
                sortTable(2);
            });

            $('#sortLicenseNumber').click(function () {
                sortTable(3);
            });

            function sortTable(column) {
                var order = table.order()[0][0];
                table.order([order, (order === column ? 'desc' : 'asc')]).draw();
            }

           
        });
        function editClient(id) {
            debugger;
            // Get the DataTable instance
            var table = $('#clientTable').DataTable();

            // Find the row with the corresponding ID
            var row = table.row('#' + id);

            // Get the data for the selected row
            var rowData = row.data();

            // Update the modal form with the fetched data
            $('#clientModalEdit input[name="ClientModel.Id"]').val(rowData.Id);
            $('#clientModalEdit input[name="ClientModel.Name"]').val(rowData.Name);
            $('#clientModalEdit input[name="ClientModel.ClientId"]').val(rowData.ClientId);
            $('#clientModalEdit input[name="ClientModel.LicenseNumber"]').val(rowData.LicenseNumber);
            $('#clientModalEdit input[name="ClientModel.LicenseStartDate"]').val(rowData.LicenseStartDate);
            $('#clientModalEdit input[name="ClientModel.LicenseEndDate"]').val(rowData.LicenseEndDate);

            // Show the modal popup
            $('#clientModalEdit').modal('show');
        }


        function deleteClient(id) {
            // Implement the delete functionality here
        }
    </script>
}
